import os
import random
random.seed(12)
import csv

DIR_PATH = '/mnt/D/C3iHackathonDataset/'
DYNAMIC_DIR = 'dynamic'
STATIC_DIR = 'static'
BENIGN_DIR = 'Benign'
MALWARE_DIR = 'Malware'
BENIGN_CLASS = 0
MALWARE_CLASS = 1
VAL_SPLIT = 0.25

MALWARE_CATEGORIES = os.listdir(os.path.join(DIR_PATH, DYNAMIC_DIR, MALWARE_DIR))

training_data = []
validation_data = []

####################################################################################
# Code to create train val split
####################################################################################

for category in MALWARE_CATEGORIES:
    for dir_name in os.listdir(os.path.join(DIR_PATH, STATIC_DIR, MALWARE_DIR, category)):
        if random.uniform(0, 1) < VAL_SPLIT:
            validation_data.append([dir_name, category, MALWARE_CLASS])
        else:
            training_data.append([dir_name, category, MALWARE_CLASS])

for dir_name in os.listdir(os.path.join(DIR_PATH, STATIC_DIR, BENIGN_DIR)):
    if random.uniform(0, 1) < VAL_SPLIT:
        validation_data.append([dir_name, 'Benign', BENIGN_CLASS])
    else:
        training_data.append([dir_name, 'Benign', BENIGN_CLASS])
        
with open('training_data.csv', 'w', newline='') as myfile:
    wr = csv.writer(myfile) #, quoting=csv.QUOTE_ALL
    wr.writerows(training_data)

with open('validation_data.csv', 'w', newline='') as myfile:
    wr = csv.writer(myfile) #, quoting=csv.QUOTE_ALL
    wr.writerows(validation_data)

    
print('Training Data size : ', len(training_data))
print('Validation Data size : ', len(validation_data))


####################################################################################
# Code to read csv into list
####################################################################################

with open('training_data.csv', newline='') as f:
    reader = csv.reader(f)
    training_data = list(reader)
    
with open('validation_data.csv', newline='') as f:
    reader = csv.reader(f)
    validation_data = list(reader)

print('Training Data size : ', len(training_data))
print('Validation Data size : ', len(validation_data))

print(training_data[0]) # we get output like this ['3e54a42a1fc48b9cb8adf5c712ed89c06ab41f62e0fe3feaa0141d3771671071.json', 'Backdoor', '1']